<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{base}">

<head>
    <title>X√°c nh·∫≠n ƒë·∫∑t h√†ng - Shopping System</title>
    <th:block layout:fragment="extra-styles">
        <style>
            .order-info {
                background-color: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 30px;
            }

            .info-row {
                display: flex;
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid #dee2e6;
            }

            .info-row:last-child {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
            }

            .info-label {
                font-weight: 600;
                color: #495057;
                width: 200px;
                flex-shrink: 0;
            }

            .info-value {
                color: #212529;
                flex-grow: 1;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background-color: white;
            }

            th,
            td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            th {
                background-color: #007bff;
                color: white;
                font-weight: 600;
            }

            tr:hover {
                background-color: #f8f9fa;
            }

            .product-img {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 4px;
            }

            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 30px;
            }

            .btn-confirm {
                background-color: #28a745;
                color: white;
            }

            .btn-confirm:hover {
                background-color: #218838;
            }

            .btn-cancel {
                background-color: #6c757d;
                color: white;
            }

            .btn-cancel:hover {
                background-color: #5a6268;
            }

            .summary-section {
                background-color: #d4edda;
                padding: 20px;
                border-radius: 8px;
                margin-top: 20px;
            }

            .summary-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
                font-size: 18px;
            }

            .summary-row.total {
                font-weight: bold;
                font-size: 24px;
                color: #28a745;
                border-top: 2px solid #28a745;
                padding-top: 15px;
                margin-top: 15px;
            }

            @media (max-width: 768px) {
                .info-row {
                    flex-direction: column;
                }

                .info-label {
                    width: 100%;
                    margin-bottom: 5px;
                }

                .button-group {
                    flex-direction: column;
                }

                button,
                .btn {
                    width: 100%;
                }

                table {
                    font-size: 12px;
                }

                th,
                td {
                    padding: 8px;
                }
            }
        </style>
    </th:block>
</head>

<body>
    <section layout:fragment="content">
        <h1>üõí X√°c Nh·∫≠n ƒê·∫∑t H√†ng</h1>

        <div class="order-info">
            <div class="info-row">
                <span class="info-label">Ng∆∞·ªùi ƒë·∫∑t h√†ng:</span>
                <span class="info-value" th:text="${username}">User</span>
            </div>
        </div>

        <!-- B·∫£ng danh s√°ch s·∫£n ph·∫©m -->
        <h2>Danh s√°ch s·∫£n ph·∫©m ƒë·∫∑t h√†ng</h2>
        <table>
            <thead>
                <tr>
                    <th>No</th>
                    <th>H√¨nh ·∫£nh</th>
                    <th>M√£ s·∫£n ph·∫©m</th>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th>Lo·∫°i s·∫£n ph·∫©m</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item, iterStat : ${orderItems}">
                    <td th:text="${iterStat.index + 1}">1</td>
                    <td>
                        <img th:src="@{'/products/image/' + ${item.productId}}" alt="Product Image" class="product-img"
                            onerror="this.style.display='none'">
                    </td>
                    <td th:text="${item.productId}">1</td>
                    <td th:text="${item.productName}">Product Name</td>
                    <td th:text="${item.producttypeName}">Category</td>
                    <td th:text="${item.quantity}">0</td>
                </tr>
            </tbody>
        </table>

        <!-- T·ªïng k·∫øt -->
        <div class="summary-section">
            <div class="summary-row">
                <span>T·ªïng s·ªë s·∫£n ph·∫©m:</span>
                <span th:text="${orderItems.size()}">0</span>
            </div>
            <div class="summary-row">
                <span>T·ªïng s·ªë l∆∞·ª£ng:</span>
                <span th:text="${#aggregates.sum(orderItems.![quantity])}">0</span>
            </div>
        </div>
        </div>

        <form method="post" th:action="@{/orders/confirm}">
            <input type="hidden" th:each="item, iterStat : ${orderItems}"
                th:name="'productIds[' + ${iterStat.index} + ']'" th:value="${item.productId}">
            <input type="hidden" th:each="item, iterStat : ${orderItems}"
                th:name="'quantities[' + ${iterStat.index} + ']'" th:value="${item.quantity}">

            <div class="button-group">
                <button type="submit" class="btn-confirm">‚úì X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
                <button type="button" class="btn btn-cancel" onclick="cancelOrder()">‚úó H·ªßy</button>
            </div>
        </form>

        <script th:inline="javascript">
            function cancelOrder() {
                // L·∫•y search params t·ª´ server
                const keyword = /*[[${keyword}]]*/ '';
                const producttypeId = /*[[${producttypeId}]]*/ '';
                const page = /*[[${page}]]*/ 0;
                const productIds = /*[[${productIds}]]*/[];
                const quantities = /*[[${quantities}]]*/[];

                // Build URL v·ªõi search params
                let url = '/products/list?';
                if (keyword) {
                    url += 'keyword=' + encodeURIComponent(keyword) + '&';
                }
                if (producttypeId) {
                    url += 'producttypeId=' + producttypeId + '&';
                }
                url += 'page=' + page;

                // Th√™m quantities v√†o URL ƒë·ªÉ restore
                productIds.forEach((id, index) => {
                    url += '&qty_' + id + '=' + quantities[index];
                });

                window.location.href = url;
            }
        </script>
    </section>
</body>

</html>